{% extends "staff_home.html" %}

{% block content %}

<style>
    .card-box {
        background: #fff;
        padding: 25px;
        border-radius: 14px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.07);
        margin-bottom: 25px;
    }

    .section-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 12px;
    }

    /* Order Status Badge */
    .status-badge {
        padding: 6px 12px;
        font-size: 12px;
        font-weight: 600;
        border-radius: 6px;
        text-transform: capitalize;
    }

    .status-placed { background:#e7d5ff; color:#5a00b3; }
    .status-confirmed { background:#d0f0ff; color:#006a8f; }
    .status-shipped { background:#fff1c2; color:#8a6a00; }
    .status-delivered { background:#d6ffd8; color:#007c1a; }

    /* Payment status badge */
    .pay-pending { background:#ffe0e0; color:#b90000; padding:6px 12px; border-radius:6px; font-size:12px; font-weight:600; }
    .pay-success { background:#d4ffe0; color:#006b1a; padding:6px 12px; border-radius:6px; font-size:12px; font-weight:600; }

    .order-img {
        width: 75px;
        height: 75px;
        border-radius: 8px;
        object-fit: cover;
        border: 1px solid #ddd;
    }

    .form-label {
        font-weight: 500;
        margin-bottom: 6px;
    }

    .divider {
        height: 1px;
        background: #eee;
        margin: 15px 0;
    }
</style>


<div class="container mt-4" style="max-width: 900px;">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 style="font-weight:600;">Order #{{ order.id }}</h3>

        <span class="status-badge status-{{ order.status }}">
            {{ order.get_status_display }}
        </span>
    </div>


    <!-- CUSTOMER DETAILS -->
    <div class="card-box">
        <div class="section-title">üë§ Customer Details</div>

        <p class="mb-1"><strong>{{ order.full_name }}</strong></p>
        <p class="mb-1">üìû {{ order.phone }}</p>

        <p class="mb-0">
            üìç {{ order.address.house }},
            {{ order.address.city }},
            {{ order.address.state }} - {{ order.address.pincode }}
        </p>
    </div>


    <!-- PAYMENT DETAILS -->
    <div class="card-box">
        <div class="section-title">üí≥ Payment Details</div>

        <!-- Payment Status -->
        <p class="mb-2 d-flex align-items-center">
            <strong style="width: 150px;">Status:</strong>

            {% if order.payment_status|lower == "paid" %}
                <span class="pay-success">Payment Successful</span>
            {% elif order.payment_status|lower == "failed" %}
                <span class="pay-pending">Payment Failed</span>
            {% else %}
                <span class="pay-pending">Pending / Failed</span>
            {% endif %}
        </p>

        <!-- Payment ID -->
        <p class="mb-2 d-flex align-items-center">
            <strong style="width: 150px;">Payment ID:</strong>

            {% if order.payment_id %}
                <span>{{ order.payment_id }}</span>
            {% else %}
                <span class="text-muted">Not Available</span>
            {% endif %}
        </p>

        <!-- Amount -->
        <p class="mb-0 d-flex align-items-center">
            <strong style="width: 150px;">Amount Paid:</strong>
            ‚Çπ{{ order.total_amount }}
        </p>
    </div>


    <!-- ORDER ITEMS -->
    <div class="card-box">
        <div class="section-title">üõç Order Items</div>

        {% for item in items %}
        <div class="d-flex align-items-center mb-3">

            <!-- Image -->
            <div>
                <img src="{{ item.product.cover_image.url }}" class="order-img">
            </div>

            <!-- Info -->
            <div class="ms-3">
                <h6 class="mb-1">{{ item.product.name }}</h6>
                <small class="text-muted">
                    Size: {{ item.size }} | Qty: {{ item.quantity }}
                </small>
                <p class="mt-1 fw-bold text-dark">‚Çπ{{ item.price }}</p>
            </div>
        </div>

        <div class="divider"></div>
        {% endfor %}

        <h5 class="text-end mt-3">
            Total: <strong>‚Çπ{{ order.total_amount }}</strong>
        </h5>
    </div>


    <!-- UPDATE ORDER -->
    <div class="card-box">
        <div class="section-title">‚öô Update Order</div>

        <form method="POST" action="{% url 'update_order' order.id %}">
            {% csrf_token %}

            <label class="form-label">Status</label>
            <select name="status" class="form-select mb-3">
                {% for value,label in order.ORDER_STATUS %}
                <option value="{{ value }}" {% if order.status == value %}selected{% endif %}>
                    {{ label }}
                </option>
                {% endfor %}
            </select>

            <label class="form-label">Courier Name</label>
            <input type="text" name="courier_name"
                class="form-control mb-3"
                placeholder="e.g. Delhivery, Bluedart"
                value="{{ order.courier_name }}">

            <label class="form-label">Tracking ID</label>
            <input type="text" name="tracking_id"
                class="form-control mb-3"
                placeholder="Enter tracking number"
                value="{{ order.tracking_id }}">

            <button class="btn btn-dark w-100 py-2"
                    style="border-radius: 10px; font-size: 16px;">
                Save Changes
            </button>
        </form>
    </div>

</div>

{% endblock %}
